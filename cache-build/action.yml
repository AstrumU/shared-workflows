name: "Cache build"
description: "Cache build artifacts"
inputs:
  package-manager:
    description: "Package Manager"
    required: false
    default: yarn
outputs:
  cache-hit:
    description: "A boolean value to indicate an exact match was found for the primary key"
    value: ${{ steps.cache.outputs.cache-hit }}

runs:
  using: composite
  steps:
    - name: "Cache build"
      uses: actions/cache@v3
      if: inputs.package-manager == 'pnpm'
      id: pnpm-build-cache
      with:
        path: |
          packages/docs/*/dist
          packages/docs/*/tsconfig.tsbuildinfo
          packages/libs/*/dist
          packages/libs/*/tsconfig.tsbuildinfo
          packages/stacks/*/dist
          packages/stacks/*/tsconfig.tsbuildinfo
        key: build-${{ github.sha }}

    - name: "Cache build"
      uses: actions/cache@v3
      if: inputs.package-manager == 'yarn'
      id: yarn-build-cache
      with:
        path: |
          packages/**/dist
          packages/**/tsconfig.tsbuildinfo
        key: build-${{ github.sha }}

    - name: Get cache id
      id: cache
      shell: bash
      run: |
        if [ ${{ inputs.package-manager }} == 'yarn' ]; then 
          echo "cache-hit=${{ steps.yarn-build-cache.outputs.cache-hit }}" >> $GITHUB_OUTPUT
        else
          echo "cache-hit=${{ steps.pnpm-build-cache.outputs.cache-hit }}" >> $GITHUB_OUTPUT
        fi
